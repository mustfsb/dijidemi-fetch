"use strict";(()=>{var e={};e.id=705,e.ids=[705],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6681:e=>{e.exports=require("playwright")},586:e=>{e.exports=require("@sparticuz/chromium")},4205:e=>{e.exports=require("playwright-core")},1017:e=>{e.exports=require("path")},6929:(e,t,s)=>{s.r(t),s.d(t,{headerHooks:()=>w,originalPathname:()=>k,patchFetch:()=>S,requestAsyncStorage:()=>u,routeModule:()=>h,serverHooks:()=>p,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>m});var i={};s.r(i),s.d(i,{POST:()=>l});var a=s(5419),r=s(9108),o=s(9678),n=s(8070),c=s(7589);async function l(e){try{let{testId:t,answers:s,totalQuestions:i,dersId:a=0,odevId:r=0,turId:o=2}=await e.json(),l=(await c.Z.getHeaders()).Cookie||"",h="",u=i||40;for(let e=1;e<=u;e++)h+=s[e]||" ";let d={};Object.keys(s).forEach(e=>{d[e]=s[parseInt(e,10)]});let p=JSON.stringify({0:{[t]:{0:d}}}),w=new URLSearchParams({dersId:String(a)||"969",odevId:String(r),testId:t,turId:String(o),cevaplar:h,_:Date.now().toString()}),m=`https://www.dijidemi.com/Ogrenci2020/TestCevapKaydetV2?${w.toString()}`,k=`${l}; kullaniciId=0; soruCevap=${p}`,S=await fetch(m,{method:"GET",headers:{Cookie:k,"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36","X-Requested-With":"XMLHttpRequest",Referer:"https://www.dijidemi.com/Ogrenci","Content-Type":"application/json; charset=UTF-8"}});if(!S.ok)return n.Z.json({error:"Failed to save answers"},{status:S.status});let f=await S.text();return n.Z.json({success:!0,raw:f})}catch(e){return n.Z.json({error:e instanceof Error?e.message:"Unknown error"},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/student/save-answer/route",pathname:"/api/student/save-answer",filename:"route",bundlePath:"app/api/student/save-answer/route"},resolvedPagePath:"/Users/mustafa/Documents/GitHub/dijidemi-fetch/app/api/student/save-answer/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:u,staticGenerationAsyncStorage:d,serverHooks:p,headerHooks:w,staticGenerationBailout:m}=h,k="/api/student/save-answer/route";function S(){return(0,o.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:d})}},7589:(e,t,s)=>{s.d(t,{Z:()=>u});class i{constructor(){}static getInstance(){return i.instance||(i.instance=new i),i.instance}async getFreshCookies(){let e;if(process.env.AWS_LAMBDA_FUNCTION_VERSION||process.env.NETLIFY||process.env.AWS_LAMBDA_FUNCTION_NAME){let t=await Promise.resolve().then(s.t.bind(s,586,23)),{chromium:i}=await Promise.resolve().then(s.t.bind(s,4205,23)),a=t.default||t,r=await a.executablePath();e=await i.launch({args:a.args,executablePath:r,headless:a.headless})}else{let{chromium:t}=await Promise.resolve().then(s.t.bind(s,6681,23));e=await t.launch({headless:!0,args:["--no-sandbox","--disable-setuid-sandbox","--disable-blink-features=AutomationControlled"]})}try{let t=await e.newContext({userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36",viewport:{width:1280,height:720},locale:"tr-TR",timezoneId:"Europe/Istanbul"}),s=await t.newPage();await s.goto("https://www.dijidemi.com/login",{waitUntil:"domcontentloaded",timeout:6e4});try{await s.waitForSelector("#txtUserName",{state:"visible",timeout:3e4})}catch(e){await s.waitForTimeout(5e3)}try{await s.isVisible("#txtUserName")&&(await s.fill("#txtUserName","14308-1651"),await s.fill("#txtPassword","175F7"),await s.click("#btnLogin"),await s.waitForLoadState("networkidle",{timeout:3e4}))}catch(e){}let i=await t.cookies(),a={cf_clearance:"","ASP.NET_SessionId":"",usrtkn:""};return i.forEach(e=>{(e.name in a||["cf_clearance","ASP.NET_SessionId","usrtkn"].includes(e.name))&&(a[e.name]=e.value)}),Object.entries(a).filter(([e,t])=>!t&&["cf_clearance","ASP.NET_SessionId"].includes(e)).map(([e])=>e).length,a}catch(e){throw e}finally{e&&await e.close()}}}let a=i.getInstance();var r=s(7028);let o=require("fs");var n=s.n(o),c=s(1017),l=s.n(c);class h{constructor(){this.isRefreshing=!1,this.refreshPromise=null,this.lastDbCheck=0,this.DB_CHECK_INTERVAL=3e5,this.cookies={cf_clearance:"","ASP.NET_SessionId":"",usrtkn:""},this.baseHeaders={Host:"www.dijidemi.com",Accept:"application/json, text/plain, */*","User-Agent":"DijidemiMobile/41 CFNetwork/3860.300.31 Darwin/25.2.0","Accept-Language":"en-US,en;q=0.9","Accept-Encoding":"gzip, deflate, br",Connection:"keep-alive"}}getCookieString(){return Object.entries(this.cookies).filter(([e,t])=>t).map(([e,t])=>`${e}=${t}`).join("; ")}async loadFromSupabase(){try{let{data:e,error:t}=await r.O.from("auth_cookies").select("*").order("updated_at",{ascending:!1}).limit(1).single();if(t)return t.code,!1;if(e&&e.cookie_json){let t="string"==typeof e.cookie_json?JSON.parse(e.cookie_json):e.cookie_json;return this.cookies={...this.cookies,...t},!0}}catch(e){}return!1}async saveToSupabase(e){try{let{error:t}=await r.O.from("auth_cookies").upsert({id:1,cookie_json:e,updated_at:new Date().toISOString()});t&&t.code;try{let t=!!process.env.AWS_LAMBDA_FUNCTION_VERSION||!!process.env.NETLIFY||!!process.env.AWS_LAMBDA_FUNCTION_NAME,s=t?"/tmp":l().join(process.cwd(),"lib/cookie");t||n().existsSync(s)||n().mkdirSync(s,{recursive:!0});let i=l().join(s,"cookies.json");n().writeFileSync(i,JSON.stringify(e,null,2))}catch(e){}}catch(e){}}async ensureValidCookies(e=!1){let t=this.cookies.cf_clearance&&this.cookies["ASP.NET_SessionId"],s=Date.now()-this.lastDbCheck;if((!t||s>this.DB_CHECK_INTERVAL)&&(await this.loadFromSupabase(),this.lastDbCheck=Date.now()),!this.cookies.cf_clearance||!this.cookies["ASP.NET_SessionId"]||e){if(this.isRefreshing){this.refreshPromise&&await this.refreshPromise;return}this.isRefreshing=!0,this.refreshPromise=(async()=>{try{let e=await a.getFreshCookies();e["ASP.NET_SessionId"]&&!e.usrtkn&&(e.usrtkn=`tkn=${e["ASP.NET_SessionId"]}`),this.cookies={...this.cookies,...e},await this.saveToSupabase(this.cookies)}catch(e){}finally{this.isRefreshing=!1,this.refreshPromise=null}})(),await this.refreshPromise}}async getHeaders(){return await this.ensureValidCookies(!1),{...this.baseHeaders,Cookie:this.getCookieString()}}async refreshCookies(){await this.ensureValidCookies(!0)}}let u=new h},7028:(e,t,s)=>{s.d(t,{O:()=>r});var i=s(2318);let a=process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1vZnVncGZod2JnY3Vua2ZrcmhjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MTIxNTUsImV4cCI6MjA4MTM4ODE1NX0.M910703VczSYfcaucltLCNZKCb1-iHoyZr-5VmpkG1o",r=(0,i.eI)("https://mofugpfhwbgcunkfkrhc.supabase.co",a||"placeholder",{auth:{persistSession:!1,autoRefreshToken:!1}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),i=t.X(0,[638,206,318],()=>s(6929));module.exports=i})();