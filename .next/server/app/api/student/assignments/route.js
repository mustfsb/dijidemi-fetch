"use strict";(()=>{var e={};e.id=765,e.ids=[765],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6681:e=>{e.exports=require("playwright")},586:e=>{e.exports=require("@sparticuz/chromium")},4205:e=>{e.exports=require("playwright-core")},1017:e=>{e.exports=require("path")},4715:(e,t,i)=>{i.r(t),i.d(t,{headerHooks:()=>m,originalPathname:()=>g,patchFetch:()=>k,requestAsyncStorage:()=>u,routeModule:()=>d,serverHooks:()=>p,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>w});var s={};i.r(s),i.d(s,{POST:()=>l});var a=i(5419),r=i(9108),o=i(9678),n=i(8070),c=i(7589);async function l(e){try{let e;let t=(await c.Z.getHeaders()).Cookie||"",i=`${t}; kullaniciId = 0; soruCevap = { "0": {} }`,s="",a=!1;for(let e of["https://www.dijidemi.com/Ogrenci/_OdevDurum?___layout","https://www.dijidemi.com/Ogrenci/OdevDurum"])try{let t=await fetch(e,{method:"POST",headers:{Cookie:i,"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"text/html, */*; q=0.01","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest",Origin:"https://www.dijidemi.com",Referer:"https://www.dijidemi.com/Ogrenci"},body:""});if(t.ok){s=await t.text(),a=!0;break}}catch(e){}if(!a||!s)return n.Z.json({error:"\xd6dev listesi alınamadı. L\xfctfen tekrar giriş yapın veya cookie yenileyin."},{status:500});let r=e=>e.replace(/&#(\d+);/g,(e,t)=>String.fromCharCode(parseInt(t,10))).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'"),o=[],l=/<p class="font-small-1 m-0">([^<]+)<\/p>\s*<span>\s*([^<]+)\s*<\/span>[\s\S]*?data-rowid="(\d+)"/g;for(;null!==(e=l.exec(s));){let t=e[1].trim(),i=e[2].trim(),s=r(t).replace(/\s+/g," ");s.length>2&&o.push({title:s,dateRange:i,id:e[3],link:`https://www.dijidemi.com/Ogrenci/Odev?id=${e[3]}`})}if(0===o.length){let t=/data-rowid="(\d+)"/g,i=[];for(;null!==(e=t.exec(s));)i.includes(e[1])||i.push(e[1]);i.forEach((e,t)=>{o.push({title:`\xd6dev ${t+1}`,dateRange:"",id:e,link:`https://www.dijidemi.com/Ogrenci/Odev?id=${e}`})})}return n.Z.json({assignments:o})}catch(e){return n.Z.json({error:"Sunucu hatası oluştu."},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/student/assignments/route",pathname:"/api/student/assignments",filename:"route",bundlePath:"app/api/student/assignments/route"},resolvedPagePath:"/Users/mustafa/Documents/GitHub/dijidemi-fetch/app/api/student/assignments/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:u,staticGenerationAsyncStorage:h,serverHooks:p,headerHooks:m,staticGenerationBailout:w}=d,g="/api/student/assignments/route";function k(){return(0,o.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:h})}},7589:(e,t,i)=>{i.d(t,{Z:()=>u});class s{constructor(){}static getInstance(){return s.instance||(s.instance=new s),s.instance}async getFreshCookies(){let e;if(process.env.AWS_LAMBDA_FUNCTION_VERSION||process.env.NETLIFY||process.env.AWS_LAMBDA_FUNCTION_NAME){let t=await Promise.resolve().then(i.t.bind(i,586,23)),{chromium:s}=await Promise.resolve().then(i.t.bind(i,4205,23)),a=t.default||t,r=await a.executablePath();e=await s.launch({args:a.args,executablePath:r,headless:a.headless})}else{let{chromium:t}=await Promise.resolve().then(i.t.bind(i,6681,23));e=await t.launch({headless:!0,args:["--no-sandbox","--disable-setuid-sandbox","--disable-blink-features=AutomationControlled"]})}try{let t=await e.newContext({userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36",viewport:{width:1280,height:720},locale:"tr-TR",timezoneId:"Europe/Istanbul"}),i=await t.newPage();await i.goto("https://www.dijidemi.com/login",{waitUntil:"domcontentloaded",timeout:6e4});try{await i.waitForSelector("#txtUserName",{state:"visible",timeout:3e4})}catch(e){await i.waitForTimeout(5e3)}try{await i.isVisible("#txtUserName")&&(await i.fill("#txtUserName","14308-1651"),await i.fill("#txtPassword","175F7"),await i.click("#btnLogin"),await i.waitForLoadState("networkidle",{timeout:3e4}))}catch(e){}let s=await t.cookies(),a={cf_clearance:"","ASP.NET_SessionId":"",usrtkn:""};return s.forEach(e=>{(e.name in a||["cf_clearance","ASP.NET_SessionId","usrtkn"].includes(e.name))&&(a[e.name]=e.value)}),Object.entries(a).filter(([e,t])=>!t&&["cf_clearance","ASP.NET_SessionId"].includes(e)).map(([e])=>e).length,a}catch(e){throw e}finally{e&&await e.close()}}}let a=s.getInstance();var r=i(7028);let o=require("fs");var n=i.n(o),c=i(1017),l=i.n(c);class d{constructor(){this.isRefreshing=!1,this.refreshPromise=null,this.lastDbCheck=0,this.DB_CHECK_INTERVAL=3e5,this.cookies={cf_clearance:"","ASP.NET_SessionId":"",usrtkn:""},this.baseHeaders={Host:"www.dijidemi.com",Accept:"application/json, text/plain, */*","User-Agent":"DijidemiMobile/41 CFNetwork/3860.300.31 Darwin/25.2.0","Accept-Language":"en-US,en;q=0.9","Accept-Encoding":"gzip, deflate, br",Connection:"keep-alive"}}getCookieString(){return Object.entries(this.cookies).filter(([e,t])=>t).map(([e,t])=>`${e}=${t}`).join("; ")}async loadFromSupabase(){try{let{data:e,error:t}=await r.O.from("auth_cookies").select("*").order("updated_at",{ascending:!1}).limit(1).single();if(t)return t.code,!1;if(e&&e.cookie_json){let t="string"==typeof e.cookie_json?JSON.parse(e.cookie_json):e.cookie_json;return this.cookies={...this.cookies,...t},!0}}catch(e){}return!1}async saveToSupabase(e){try{let{error:t}=await r.O.from("auth_cookies").upsert({id:1,cookie_json:e,updated_at:new Date().toISOString()});t&&t.code;try{let t=!!process.env.AWS_LAMBDA_FUNCTION_VERSION||!!process.env.NETLIFY||!!process.env.AWS_LAMBDA_FUNCTION_NAME,i=t?"/tmp":l().join(process.cwd(),"lib/cookie");t||n().existsSync(i)||n().mkdirSync(i,{recursive:!0});let s=l().join(i,"cookies.json");n().writeFileSync(s,JSON.stringify(e,null,2))}catch(e){}}catch(e){}}async ensureValidCookies(e=!1){let t=this.cookies.cf_clearance&&this.cookies["ASP.NET_SessionId"],i=Date.now()-this.lastDbCheck;if((!t||i>this.DB_CHECK_INTERVAL)&&(await this.loadFromSupabase(),this.lastDbCheck=Date.now()),!this.cookies.cf_clearance||!this.cookies["ASP.NET_SessionId"]||e){if(this.isRefreshing){this.refreshPromise&&await this.refreshPromise;return}this.isRefreshing=!0,this.refreshPromise=(async()=>{try{let e=await a.getFreshCookies();e["ASP.NET_SessionId"]&&!e.usrtkn&&(e.usrtkn=`tkn=${e["ASP.NET_SessionId"]}`),this.cookies={...this.cookies,...e},await this.saveToSupabase(this.cookies)}catch(e){}finally{this.isRefreshing=!1,this.refreshPromise=null}})(),await this.refreshPromise}}async getHeaders(){return await this.ensureValidCookies(!1),{...this.baseHeaders,Cookie:this.getCookieString()}}async refreshCookies(){await this.ensureValidCookies(!0)}}let u=new d},7028:(e,t,i)=>{i.d(t,{O:()=>r});var s=i(2318);let a=process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1vZnVncGZod2JnY3Vua2ZrcmhjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MTIxNTUsImV4cCI6MjA4MTM4ODE1NX0.M910703VczSYfcaucltLCNZKCb1-iHoyZr-5VmpkG1o",r=(0,s.eI)("https://mofugpfhwbgcunkfkrhc.supabase.co",a||"placeholder",{auth:{persistSession:!1,autoRefreshToken:!1}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),s=t.X(0,[638,206,318],()=>i(4715));module.exports=s})();