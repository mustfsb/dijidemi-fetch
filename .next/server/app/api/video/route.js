"use strict";(()=>{var e={};e.id=700,e.ids=[700],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6681:e=>{e.exports=require("playwright")},586:e=>{e.exports=require("@sparticuz/chromium")},4205:e=>{e.exports=require("playwright-core")},1017:e=>{e.exports=require("path")},1347:(e,t,i)=>{i.r(t),i.d(t,{headerHooks:()=>w,originalPathname:()=>f,patchFetch:()=>k,requestAsyncStorage:()=>h,routeModule:()=>u,serverHooks:()=>p,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>m});var s={};i.r(s),i.d(s,{GET:()=>l});var a=i(5419),r=i(9108),o=i(9678),n=i(8070),c=i(7589);async function l(e){let{searchParams:t}=new URL(e.url),i=t.get("testId"),s=t.get("soruId");if(!i||!s)return n.Z.json({error:"Missing testId or soruId"},{status:400});let a=await c.Z.getHeaders(),r=`tur=2&sinavId=0&sinavTuru=2&testId=${i}&soruId=${s}`;try{let e=await fetch("https://www.dijidemi.com/Ogrenci2020/Video?___layout",{method:"POST",headers:{...a,"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:r});if(!e.ok)return n.Z.json({error:`Upstream error: ${e.status}`},{status:e.status});let t=await e.text(),o=null,c=t.match(/<video[^>]*src="([^"]+)"/i);if(c&&(o=c[1]),!o){let e=t.match(/<source[^>]*src="([^"]+)"/i);e&&(o=e[1])}if(!o){let e=t.match(/"([^"]+\.mp4)"/);e&&(o=e[1])}if(o)return n.Z.json({success:!0,videoUrl:o,testId:i,soruId:s});return n.Z.json({success:!1,message:"Video not found"})}catch(e){return n.Z.json({error:"Internal Server Error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let u=new a.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/video/route",pathname:"/api/video",filename:"route",bundlePath:"app/api/video/route"},resolvedPagePath:"/Users/mustafa/Documents/GitHub/dijidemi-fetch/app/api/video/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:d,serverHooks:p,headerHooks:w,staticGenerationBailout:m}=u,f="/api/video/route";function k(){return(0,o.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:d})}},7589:(e,t,i)=>{i.d(t,{Z:()=>h});class s{constructor(){}static getInstance(){return s.instance||(s.instance=new s),s.instance}async getFreshCookies(){let e;if(process.env.AWS_LAMBDA_FUNCTION_VERSION||process.env.NETLIFY||process.env.AWS_LAMBDA_FUNCTION_NAME){let t=await Promise.resolve().then(i.t.bind(i,586,23)),{chromium:s}=await Promise.resolve().then(i.t.bind(i,4205,23)),a=t.default||t;e=await s.launch({args:a.args,executablePath:await a.executablePath(),headless:a.headless})}else{let{chromium:t}=await Promise.resolve().then(i.t.bind(i,6681,23));e=await t.launch({headless:!0,args:["--no-sandbox","--disable-setuid-sandbox","--disable-blink-features=AutomationControlled"]})}try{let t=await e.newContext({userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36",viewport:{width:1280,height:720},locale:"tr-TR",timezoneId:"Europe/Istanbul"}),i=await t.newPage();await i.goto("https://www.dijidemi.com/login",{waitUntil:"domcontentloaded",timeout:6e4});try{await i.waitForSelector("#txtUserName",{state:"visible",timeout:3e4})}catch(e){await i.waitForTimeout(5e3)}try{await i.isVisible("#txtUserName")&&(await i.fill("#txtUserName","14308-1651"),await i.fill("#txtPassword","175F7"),await i.click("#btnLogin"),await i.waitForLoadState("networkidle",{timeout:3e4}))}catch(e){}let s=await t.cookies(),a={cf_clearance:"","ASP.NET_SessionId":"",usrtkn:""};return s.forEach(e=>{(e.name in a||["cf_clearance","ASP.NET_SessionId","usrtkn"].includes(e.name))&&(a[e.name]=e.value)}),Object.entries(a).filter(([e,t])=>!t&&["cf_clearance","ASP.NET_SessionId"].includes(e)).map(([e])=>e).length,a}catch(e){throw e}finally{e&&await e.close()}}}let a=s.getInstance();var r=i(7028);let o=require("fs");var n=i.n(o),c=i(1017),l=i.n(c);class u{constructor(){this.isRefreshing=!1,this.refreshPromise=null,this.lastDbCheck=0,this.DB_CHECK_INTERVAL=3e5,this.cookies={cf_clearance:"","ASP.NET_SessionId":"",usrtkn:""},this.baseHeaders={Host:"www.dijidemi.com",Accept:"application/json, text/plain, */*","User-Agent":"DijidemiMobile/41 CFNetwork/3860.300.31 Darwin/25.2.0","Accept-Language":"en-US,en;q=0.9","Accept-Encoding":"gzip, deflate, br",Connection:"keep-alive"}}getCookieString(){return Object.entries(this.cookies).filter(([e,t])=>t).map(([e,t])=>`${e}=${t}`).join("; ")}async loadFromSupabase(){try{let{data:e,error:t}=await r.O.from("auth_cookies").select("*").order("updated_at",{ascending:!1}).limit(1).single();if(t)return t.code,!1;if(e&&e.cookie_json){let t="string"==typeof e.cookie_json?JSON.parse(e.cookie_json):e.cookie_json;return this.cookies={...this.cookies,...t},!0}}catch(e){}return!1}async saveToSupabase(e){try{let{error:t}=await r.O.from("auth_cookies").upsert({id:1,cookie_json:e,updated_at:new Date().toISOString()});try{let t=l().join(process.cwd(),"lib/cookie/cookies.json");n().writeFileSync(t,JSON.stringify(e,null,2))}catch(e){}}catch(e){}}async ensureValidCookies(e=!1){let t=this.cookies.cf_clearance&&this.cookies["ASP.NET_SessionId"],i=Date.now()-this.lastDbCheck;if((!t||i>this.DB_CHECK_INTERVAL)&&(await this.loadFromSupabase(),this.lastDbCheck=Date.now()),!this.cookies.cf_clearance||!this.cookies["ASP.NET_SessionId"]||e){if(this.isRefreshing){this.refreshPromise&&await this.refreshPromise;return}this.isRefreshing=!0,this.refreshPromise=(async()=>{try{let e=await a.getFreshCookies();e["ASP.NET_SessionId"]&&!e.usrtkn&&(e.usrtkn=`tkn=${e["ASP.NET_SessionId"]}`),this.cookies={...this.cookies,...e},await this.saveToSupabase(this.cookies)}catch(e){}finally{this.isRefreshing=!1,this.refreshPromise=null}})(),await this.refreshPromise}}async getHeaders(){return await this.ensureValidCookies(!1),{...this.baseHeaders,Cookie:this.getCookieString()}}async refreshCookies(){await this.ensureValidCookies(!0)}}let h=new u},7028:(e,t,i)=>{i.d(t,{O:()=>r});var s=i(2318);let a=process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1vZnVncGZod2JnY3Vua2ZrcmhjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MTIxNTUsImV4cCI6MjA4MTM4ODE1NX0.M910703VczSYfcaucltLCNZKCb1-iHoyZr-5VmpkG1o",r=(0,s.eI)("https://mofugpfhwbgcunkfkrhc.supabase.co",a||"placeholder",{auth:{persistSession:!1,autoRefreshToken:!1}})}};var t=require("../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),s=t.X(0,[638,206,318],()=>i(1347));module.exports=s})();